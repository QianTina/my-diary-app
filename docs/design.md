# 日记项目设计文档

## 1. 项目概述
本项目旨在开发一个简洁、易用的个人日记应用程序，帮助用户记录日常点滴、心情感悟以及重要事件。

## 2. 功能规划

### 2.1 核心功能 (MVP)
*   **日记管理**：
    *   **新建日记**：支持纯文本输入，可选支持 Markdown 格式。
    *   **查看日记**：以列表或时间轴形式展示日记。
    *   **编辑日记**：修改已保存的日记内容。
    *   **删除日记**：移除不需要的日记条目。
*   **数据持久化**：
    *   数据保存在本地，确保隐私安全。

### 2.2 进阶功能 (v2.0)
*   **搜索功能**：通过关键词快速查找日记。
*   **分类与标签**：支持为日记添加标签（如：心情、工作、生活），便于分类管理。
*   **日历视图**：通过日历查看特定日期的日记。
*   **多媒体支持**：支持插入图片或语音备忘。
*   **数据导出/导入**：支持导出为 JSON/Markdown 文件，或从备份恢复。

## 3. 技术架构选择：React + Vite

基于“快速开发”且“后期考虑小程序”的需求，我们选择 **React** 技术栈。

*   **核心框架**: React 18 + TypeScript
    *   *理由*：生态丰富，组件化开发。React 代码逻辑（Hooks/Utils）易于复用到小程序框架（如 Taro）。
*   **构建工具**: Vite
    *   *理由*：启动速度极快，开发体验极佳。
*   **UI 样式**: Tailwind CSS
    *   *理由*：开发效率高，原子化 CSS 易于维护。
*   **路由**: React Router v6
*   **状态管理**: Zustand (轻量级，适合日记应用) 或 React Context
*   **数据存储**: 
    *   **当前 (MVP)**: LocalStorage (本地持久化)，但已封装为异步接口 `Promise`，模拟后端交互。
    *   **未来**: 可无缝迁移至 Supabase / Firebase / Node.js 后端，因为前端已通过 Service 层解耦。

### 为什么适合后期转小程序？
使用 React 开发，未来可以使用 **Taro** 框架进行重构。Taro 支持使用 React 语法开发小程序，业务逻辑代码（Hooks, Services）可以高度复用，只需调整 UI 组件层。

## 4. 数据结构设计 (示例)

```json
{
  "id": "uuid-v4",
  "title": "今天的日记标题",
  "content": "日记的正文内容...",
  "created_at": "2023-10-27T10:00:00Z",
  "updated_at": "2023-10-27T10:00:00Z",
  "tags": ["开心", "生活"]
}
```

## 5. 已完成功能 (MVP v1.0)
- ✅ 日记 CRUD 操作（新增、查看、编辑、删除）
- ✅ 实时搜索过滤
- ✅ 草稿自动保存
- ✅ LocalStorage + Supabase 双模式数据持久化
- ✅ 响应式 UI 设计（Tailwind CSS）
- ✅ 加载状态和错误处理

## 6. 优化方向与实现计划

### 6.1 状态管理升级 (Zustand)
**目标**：随着功能增多，使用 Zustand 替代 useState，提升代码可维护性。

**实现要点**：
- 创建 `src/store/diaryStore.ts`
- 集中管理日记列表、加载状态、编辑状态
- 简化组件逻辑，提升性能

### 6.2 标签系统
**目标**：支持为日记添加多个标签（如：#开心 #工作 #旅行）

**实现要点**：
- 扩展 `Diary` 类型，添加 `tags: string[]` 字段
- UI 支持标签输入（空格分隔或 # 开头）
- 支持按标签筛选日记
- 标签云展示（显示常用标签）

### 6.3 Markdown 支持
**目标**：支持 Markdown 格式编写和预览

**实现要点**：
- 集成 `react-markdown` 库
- 添加"预览/编辑"切换按钮
- 支持基础 Markdown 语法（标题、列表、粗体、斜体、链接）

### 6.4 数据导出/导入
**目标**：支持备份和恢复数据

**实现要点**：
- 导出为 JSON 格式（包含所有日记数据）
- 导出为 Markdown 文件（每条日记一个文件或合并为一个文件）
- 支持从 JSON 文件导入恢复数据
- 添加"设置"页面，放置导入/导出功能

### 6.5 日历视图
**目标**：通过日历快速查看特定日期的日记

**实现要点**：
- 集成轻量级日历组件
- 标记有日记的日期
- 点击日期跳转到对应日记

## 7. 技术实现细节

### 7.1 依赖安装
```bash
npm install zustand react-markdown
```

### 7.2 目录结构（优化后）
```
src/
├── components/          # UI 组件
│   ├── DiaryEditor.tsx  # 编辑器组件
│   ├── DiaryList.tsx    # 列表组件
│   ├── TagInput.tsx     # 标签输入组件
│   └── Calendar.tsx     # 日历组件
├── store/
│   └── diaryStore.ts    # Zustand 状态管理
├── utils/
│   ├── storage.ts       # 数据持久化
│   ├── supabase.ts      # Supabase 客户端
│   └── export.ts        # 导出工具函数
├── types.ts             # 类型定义
├── App.tsx              # 主应用
└── main.tsx             # 入口文件
```

## 8. 下一步计划
1. ✅ 完成 MVP 核心功能
2. ✅ 实现状态管理升级（Zustand）
3. ✅ 添加标签系统
4. ✅ 集成 Markdown 支持
5. ✅ 实现数据导出/导入功能
6. 🔄 日历视图（待开发）
7. 🔄 图片上传支持（待开发）

## 9. 项目结构

```
my-diary-app/
├── src/
│   ├── components/          # UI 组件
│   │   ├── TagInput.tsx     # 标签输入组件
│   │   └── MarkdownPreview.tsx  # Markdown 预览组件
│   ├── store/
│   │   └── diaryStore.ts    # Zustand 状态管理
│   ├── utils/
│   │   ├── storage.ts       # 数据持久化层
│   │   ├── supabase.ts      # Supabase 客户端
│   │   └── export.ts        # 导出/导入工具
│   ├── types.ts             # TypeScript 类型定义
│   ├── App.tsx              # 主应用组件
│   ├── main.tsx             # 应用入口
│   └── index.css            # 全局样式
├── sql/
│   └── schema.sql           # 数据库表结构
├── docs/
│   └── design.md            # 设计文档
├── .env.example             # 环境变量模板
└── README.md                # 项目说明

```

## 10. 已实现的优化

### 10.1 状态管理（Zustand）
- 集中管理日记列表、加载状态、编辑状态
- 提供计算属性（过滤、标签统计）
- 简化组件逻辑，提升性能

### 10.2 标签系统
- 支持为每条日记添加多个标签
- 标签云展示（按使用频率排序）
- 支持按标签筛选日记
- 标签输入支持回车添加、退格删除

### 10.3 Markdown 支持
- 集成 `react-markdown` 库
- 支持编辑/预览模式切换
- 自定义样式，保持界面一致性
- 支持标题、列表、粗体、斜体、链接、代码、引用等语法

### 10.4 数据导出/导入
- 导出为 JSON（完整数据备份）
- 导出为 Markdown（可读性强，便于分享）
- 从 JSON 导入恢复数据
- 文件名自动添加日期标识

## 11. 技术亮点

1. **架构解耦**：通过 Service 层（`storage.ts`）实现数据源切换，支持 LocalStorage 和 Supabase
2. **类型安全**：完整的 TypeScript 类型定义
3. **性能优化**：使用 Zustand 避免不必要的重渲染
4. **用户体验**：草稿自动保存、加载状态、错误处理
5. **可扩展性**：组件化设计，易于添加新功能
6. **小程序友好**：业务逻辑与 UI 分离，便于迁移到 Taro
