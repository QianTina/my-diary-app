# 功能详解

## 1. 日记编辑器

### 基础功能
- **文本输入**：支持多行文本输入
- **Markdown 支持**：使用 Markdown 语法格式化内容
- **实时预览**：点击"👁️ 预览"按钮查看渲染效果
- **草稿保存**：自动保存未提交的内容

### 标签系统
- **添加标签**：在标签输入框输入标签名，按回车添加
- **删除标签**：点击标签上的 × 按钮删除
- **标签显示**：标签以蓝色圆角标签形式展示

### 编辑模式
- **新建模式**：默认状态，点击"立即记录"创建新日记
- **编辑模式**：点击日记的"编辑"按钮进入，显示"确认更新"按钮
- **取消编辑**：点击"取消"按钮退出编辑模式

## 2. 日记列表

### 显示信息
- **时间戳**：显示创建时间（月-日 时:分）
- **标签**：显示该日记的所有标签
- **内容**：以 Markdown 渲染的形式展示

### 操作按钮
- **编辑**：进入编辑模式
- **删除**：删除日记（需确认）

### 视觉反馈
- **编辑高亮**：正在编辑的日记会有绿色边框和背景
- **悬停效果**：鼠标悬停时阴影加深

## 3. 搜索与筛选

### 关键词搜索
- **实时搜索**：输入关键词即时过滤
- **不区分大小写**：搜索时忽略大小写
- **匹配内容**：搜索日记正文内容

### 标签筛选
- **标签云**：显示所有使用过的标签
- **频率排序**：标签按使用频率从高到低排序
- **多选筛选**：可以选择多个标签（AND 逻辑）
- **高亮显示**：选中的标签显示为蓝色背景

### 统计信息
- 显示当前筛选结果数量
- 显示总日记数量

## 4. 数据管理

### 导出功能

#### JSON 格式
```json
[
  {
    "id": "abc123",
    "content": "今天天气很好",
    "tags": ["开心", "生活"],
    "createdAt": "2024-01-27T10:00:00.000Z"
  }
]
```
- **用途**：完整数据备份，可用于导入恢复
- **文件名**：`diary-backup-YYYY-MM-DD.json`

#### Markdown 格式
```markdown
# 我的日记

## 2024年1月27日 10:00
**标签**: #开心 #生活

今天天气很好

---
```
- **用途**：可读性强，便于分享或打印
- **文件名**：`diary-export-YYYY-MM-DD.md`

### 导入功能
- **格式要求**：仅支持 JSON 格式
- **数据验证**：自动验证数据结构
- **合并策略**：导入的数据会添加到现有日记中

## 5. 状态管理（Zustand）

### 全局状态
```typescript
{
  diaries: Diary[],           // 日记列表
  isLoading: boolean,         // 加载状态
  editingId: string | null,   // 正在编辑的日记 ID
  searchQuery: string,        // 搜索关键词
  selectedTags: string[]      // 选中的标签
}
```

### 操作方法
- `fetchDiaries()`: 获取所有日记
- `createDiary()`: 创建新日记
- `updateDiaryById()`: 更新日记
- `deleteDiaryById()`: 删除日记
- `setEditingId()`: 设置编辑状态
- `setSearchQuery()`: 设置搜索关键词
- `toggleTag()`: 切换标签选择
- `getFilteredDiaries()`: 获取过滤后的日记
- `getAllTags()`: 获取所有标签

## 6. 数据持久化

### LocalStorage 模式
```typescript
// 存储键
const LS_KEY = 'diary_items';

// 数据结构
localStorage.setItem(LS_KEY, JSON.stringify(diaries));
```

### Supabase 模式
```sql
-- 表结构
CREATE TABLE diaries (
  id UUID PRIMARY KEY,
  content TEXT NOT NULL,
  tags TEXT[] DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 自动切换
- 检测环境变量 `VITE_SUPABASE_URL`
- 如果配置了 Supabase，使用云端存储
- 否则使用 LocalStorage

## 7. Markdown 支持

### 支持的语法

#### 标题
```markdown
# 一级标题
## 二级标题
### 三级标题
```

#### 文本样式
```markdown
**粗体**
*斜体*
`代码`
```

#### 列表
```markdown
- 无序列表项 1
- 无序列表项 2

1. 有序列表项 1
2. 有序列表项 2
```

#### 链接
```markdown
[链接文字](https://example.com)
```

#### 引用
```markdown
> 这是一段引用
```

### 自定义样式
- 标题：不同大小的粗体
- 列表：带缩进的项目符号
- 链接：蓝色可点击
- 代码：灰色背景
- 引用：左侧灰色边框

## 8. 性能优化

### 状态管理
- 使用 Zustand 避免不必要的重渲染
- 计算属性缓存（过滤、标签统计）

### 数据加载
- 异步加载日记数据
- 显示加载状态

### 用户体验
- 草稿自动保存（防止数据丢失）
- 操作确认（删除前确认）
- 错误处理（显示友好提示）

## 9. 响应式设计

### 布局适配
- 最大宽度：`max-w-4xl`（1024px）
- 自动居中：`mx-auto`
- 响应式内边距：`px-4 sm:px-6 lg:px-8`

### 移动端优化
- 触摸友好的按钮大小
- 自适应的输入框
- 流式布局

## 10. 扩展性

### 组件化设计
- `TagInput`: 可复用的标签输入组件
- `MarkdownPreview`: 可复用的 Markdown 预览组件

### 数据层解耦
- `storage.ts`: 统一的数据访问接口
- 支持多种数据源（LocalStorage、Supabase）

### 类型安全
- 完整的 TypeScript 类型定义
- 编译时类型检查

### 未来扩展方向
- 日历视图
- 图片上传
- 主题切换
- 用户认证
- 多设备同步
